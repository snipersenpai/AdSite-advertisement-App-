{% extends "base_bootstrap.html" %}
{% block content %}
    <h1>Ads List</h1>
    <div style="float:right">
        <form>
          <input type="text" placeholder="Search.." name="search"
          {% if search %} value="{{ search }}" {% endif %}
          >
          <button type="submit"><i class="fa fa-search"></i></button>
        <a href="{% url 'ads:all' %}"><i class="fa fa-undo"></i></a>
        </form>
    </div>
    <ul>
      {% for ad in object_list %}
          <li>
            <a href="{% url 'ads:ad_detail' ad.id %}">{{ad.title}}</a>
            {% if user.is_authenticated %}
            <!-- Two hrefs with two stacked icons each - one showing and one hidden -->
                <a href="#" onclick=
                    "favPost('{% url 'ads:ad_unfavorite' ad.id %}', {{ ad.id }} );return false;"
                    {% if ad.id not in favorites %} style="display: none;" {% endif %}
                    id="favorite_star_{{ad.id}}">
                <span class="fa-stack" style="vertical-align: middle;">
                <i class="fa fa-star fa-stack-1x" style="color: orange;"></i>
                <i class="fa fa-star-o fa-stack-1x"></i>
                </span>
                </a>
                <!-- the second href -->
                <a href="#" onclick=
                     "favPost('{% url 'ads:ad_favorite' ad.id %}', {{ ad.id }} );return false;"
                    {% if ad.id in favorites %} style="display: none;" {% endif %}
                    id="unfavorite_star_{{ad.id}}">
                <span class="fa-stack" style="vertical-align: middle;">
                <i class="fa fa-star fa-stack-1x" style="display: none; color: orange;"></i>
                <i class="fa fa-star-o fa-stack-1x"></i>
                </span>
                </a>
                {%endif%}
            {% if ad.owner == user %}
                <a href="{% url 'ads:ad_update' ad.id %}">Edit</a> |
                <a href="{% url 'ads:ad_delete' ad.id %}">Delete</a></li>
            {%endif%}
      {% empty %}
          <li>There are no ads in the database.</li>
      {% endfor %}
    </ul>
    <p>
        <a href="{% url 'ads:ad_create' %}" >
            Add an Ad
        </a>|
        {% if user.is_authenticated %}
            <a href="{% url 'logout' %}?next={% url 'ads:all' %}">
                Logout
            </a>
        {% else %}
            <a href="{% url 'login' %}?next={% url 'ads:all' %}">
                Login
            </a>
        {%endif%}
    </p>

    <script>
        function favPost(_url,_id){
            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function(){
                if (this.readyState == 4 && this.status == 200) {
                 console.log(this.responseText);
                    if (document.getElementById("unfavorite_star_"+_id).style.display=='none'){
                        document.getElementById("unfavorite_star_"+_id).style.display ='inline-block';
                    }else{
                        document.getElementById("unfavorite_star_"+_id).style.display ='none';
                    }

                    if (document.getElementById("favorite_star_"+_id).style.display=='none'){
                        document.getElementById("favorite_star_"+_id).style.display ='inline-block';
                    }else{
                        document.getElementById("favorite_star_"+_id).style.display ='none';
                    }
                    // document.getElementById("unfavorite_star_"+_id).toggle();
                    // document.getElementById("favorite_star_"+_id).toggle();
                }
            }
            xhttp.open("POST", _url, true);
            xhttp.send();
        }
    </script>

{% endblock %}
